name: Deploy Location Logger

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Update Logger Script
      run: |
        # Ensure the scripts directory exists
        mkdir -p /home/sdr/scripts
        
        # Copy the logger script
        # Assumes cymap_logger.py is in 'scripts/' folder in repo
        cp scripts/cymap_logger.py /home/sdr/scripts/
        
        # Set permissions
        chmod +x /home/sdr/scripts/cymap_logger.py
        chown sdr:sdr /home/sdr/scripts/cymap_logger.py

    - name: Restart Logger Service
      run: |
        sudo systemctl daemon-reload
        echo "Restarting CyMap Logger..."
        sudo systemctl restart cymap-logger.service

    - name: Verify Status
      run: |
        sudo systemctl status cymap-logger.service --no-pager
